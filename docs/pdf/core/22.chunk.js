/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[22],{400:function(ia,da,e){e.r(da);var ca=e(1),ea=e(12),aa=e(2);ia=e(48);var ha=e(29),ba=e(10);e=function(){function e(){this.init()}e.prototype.init=function(){this.j2=!1;this.bf=this.uk=this.connection=null;this.Hq={};this.fa=this.VC=null};e.prototype.Vga=function(e){for(var w=this,r=0;r<e.length;++r){var n=e[r];switch(n.at){case "create":this.Hq[n.author]||(this.Hq[n.author]=n.aName);this.v9(n);break;case "modify":this.fa.Uk(n.xfdf).then(function(e){w.fa.Eb(e[0])});
break;case "delete":this.fa.Uk("<delete><id>"+n.aId+"</id></delete>")}}};e.prototype.v9=function(e){var w=this;this.fa.Uk(e.xfdf).then(function(r){r=r[0];r.authorId=e.author;w.fa.Eb(r);w.fa.trigger(ea.a.UPDATE_ANNOTATION_PERMISSION,[r])})};e.prototype.U8=function(e,y,r){this.uk&&this.uk(e,y,r)};e.prototype.preloadAnnotations=function(e){this.addEventListener("webViewerServerAnnotationsEnabled",this.U8.bind(this,e,"add",{imported:!1}),{once:!0})};e.prototype.initiateCollaboration=function(w,y,r){var n=
this;if(w){n.bf=y;n.fa=r.ta();r.addEventListener(ea.c.DOCUMENT_UNLOADED,function(){n.disableCollaboration()});n.uha(w);var h=new XMLHttpRequest;h.addEventListener("load",function(){if(200===h.status&&0<h.responseText.length)try{var f=JSON.parse(h.responseText);n.connection=exports.kb.Wha(Object(ha.j)(n.bf,"blackbox/"),"annot");n.VC=f.id;n.Hq[f.id]=f.user_name;n.fa.OJ(f.id);n.connection.uK(function(e){e.t&&e.t.startsWith("a_")&&e.data&&n.Vga(e.data)},function(){n.connection.send({t:"a_retrieve",dId:w});
n.trigger(e.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[n.Hq[f.id],n.VC])},function(){n.disableCollaboration()})}catch(x){Object(aa.f)(x.message)}});h.open("GET",Object(ha.j)(this.bf,"demo/SessionInfo.jsp"));h.withCredentials=!0;h.send();n.j2=!0;n.fa.nV(function(e){return n.Hq[e.Author]||e.Author})}else Object(aa.f)("Document ID required for collaboration")};e.prototype.disableCollaboration=function(){this.uk&&(this.fa.removeEventListener(ba.a.Events.ANNOTATION_CHANGED,this.uk),this.uk=null);this.connection&&
this.connection.VF();this.fa&&this.fa.OJ("Guest");this.init();this.trigger(e.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};e.prototype.uha=function(e){var w=this;this.uk&&this.fa.removeEventListener(ba.a.Events.ANNOTATION_CHANGED,this.uk);this.uk=function(r,n,h){return Object(ca.b)(this,void 0,void 0,function(){var f,x,y,z,aa,ba,da,ea,ha;return Object(ca.d)(this,function(ca){switch(ca.label){case 0:if(h.imported)return[2];f={t:"a_"+n,dId:e,annots:[]};return[4,w.fa.$F()];case 1:x=ca.da();"delete"!==
n&&(y=(new DOMParser).parseFromString(x,"text/xml"),z=new XMLSerializer);for(aa=0;aa<r.length;aa++)ba=r[aa],ea=da=void 0,"add"===n?(da=y.querySelector('[name="'+ba.Id+'"]'),ea=z.serializeToString(da),ha=null,ba.InReplyTo&&(ha=w.fa.Lf(ba.InReplyTo).authorId||"default"),f.annots.push({at:"create",aId:ba.Id,author:w.VC,aName:w.Hq[w.VC],parent:ha,xfdf:"<add>"+ea+"</add>"})):"modify"===n?(da=y.querySelector('[name="'+ba.Id+'"]'),ea=z.serializeToString(da),f.annots.push({at:"modify",aId:ba.Id,xfdf:"<modify>"+
ea+"</modify>"})):"delete"===n&&f.annots.push({at:"delete",aId:ba.Id});0<f.annots.length&&w.connection.send(f);return[2]}})})}.bind(w);this.fa.addEventListener(ba.a.Events.ANNOTATION_CHANGED,this.uk)};e.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return e}();Object(ia.a)(e);da["default"]=e}}]);}).call(this || window)
